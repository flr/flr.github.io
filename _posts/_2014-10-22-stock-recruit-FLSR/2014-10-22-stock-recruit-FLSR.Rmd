---
title: Fitting stock-recruitment relationships with FLSR
post_author: Iago Mosqueira
date: October 2014
layout: post
tags: [FLSR FLCore]
category: learning
learning: modelling
rights:  Creative Commons Share Alike 4.0
---

A fundamental problem in the quantitative assessment of fisheries is the relationship between the reproductive potential of the stock, e.g. egg production,commonly approximated by the spawning stock biomass (SSB), and the number of recruits into the population expected to be produced. The stock-recruitment relationship is an essential element for assessing the resilience of a fish population, and forecasting the likely effect and time of responses to management measures.

Although modern statistical catch-at-age assessment methods generally integrate the estimation of the parameters of this relationship together with all others, VPA-based models require fitting the stock-recruitment relationship based on the model estimates of abundance. Also, the relationship is employed in most forecasting algorithms, such as those offered by the `FLash` package.

Stock-recruitment relationships in FLR are handled by the `FLSR` class, which contains slots for both inputs (`rec` and `ssb`), outputs (`fitted` and `residuals`), model specification (`model`, `lkhd`, `initial`), and parameter outputs (`params`, `vcov`, `logLik`).

We will now look at how objects of this class can be created, how to fit stock-recruitment models, what models are already available in `FLCore`, and the methods for model fitting, inspection of results and diagnostics.

# The FLSR class

```{r pkgs}
library(FLCore)
library(ggplotFL)
```

## Class structure

- name (`character`)
- desc (`character`)
- range

- rec
- ssb
- covar

- fitted
- residuals

- model
- lkhd
- gr
- initial
- logerror
- distribution

- params
- logLik
- vcov
- hessian
- details


```{r data}
data(nsher)
```

# Creating `FLSR` objects

The class has a creator method of the same name. The `FLSR()` method will take as inputs the objects to be assigned into the individual slots, for example

```{r create}
rec <- FLQuant(20 + c(0, cumsum(sample(rnorm(30, 0, 2)))), quant="age")
ssb <- FLQuant(100 + rnorm(31, 0, 12), quant="age")

exs <- FLSR(rec=rec, ssb=ssb, name="randFLSR")
								 
```

## Specifying the stock-recruitment model

## Converting from 	other classes

### `FLStock`

A common source of recruitment and stock biomass estimates for stock-recruitment analysis is the result of an stock assessment run, stored in an object of class `FLStock`. To simplify creating an `FLSR` object from those estimates, a conversion method exists, `as.FLSR`, to be called as follows:

```{r convert}
# LOAD FLStock object
data(ple4)

# CONVERT to FLSR
psr4 <- as.FLSR(ple4)

summary(psr4)

```

and which will use the `FLQuant` objects extracted by calling the `rec` and `ssb` methods on the input object to fill the slots with those names. Other `FLQuant` slots are then sized as required.

```{r converts}
summary(psr4)

```


```{r convertm}
# ASSIGN model
model(psr4) <- ricker
```

# Model fitting

## Maximum likelihood estimation with `fmle`

## Fixing parameters

## Using covariates

# Stock-recruitment models

### Beverton & Holt (`bevholt`)

### Ricker (`ricker`)

### Segmented regression (`segres`)

### Cushing (`cushing`)

### Shepherd (`shepherd`)

# Assessing the fit

```{r fit}
logLik(nsher)

AIC(nsher)
BIC(nsher)
```

## Likelihood profiling

```{r profplot}
profile(nsher)
```

# Adding other SR models

# Further information and References

```{r help}
help("SRmodels")
```
